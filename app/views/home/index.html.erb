<div class="row mt-3">

  <div class="col-sm-4 text-center">

    <% unless current_user.lol_name %>
      <h3>Vincule seu nome de invocador a sua conta!</h3>
      <p>Voce so precisa inserir o codigo na sua conta para que o sistema possa verificar que ela e realmente sua.</p>
      <p><strong>Seu codigo: <%= @code %></strong></p>
      <p>
        <!-- Button trigger modal -->
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleCode">
          Onde põe o código?
        </button>

        <!-- Modal -->
        <div class="modal fade" id="exampleCode" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <%= image_tag "guide.png", id: "guide-img" %>
            </div>
          </div>
        </div>

      </p>

      <%= form_with url: 'home/verify' do |f| %>
        <div class="form-group">
          <%= f.text_field :summoner_name, class: 'form-control', autocomplete: 'off', placeholder: 'Nome de invocador' %>
          <%= f.submit 'Vincular', class: 'btn btn-sm btn-block btn-primary' %>
        </div>
      <% end %>
      <%= current_user.email %>

    <% else %>
      <h2><%= current_user.lol_name %></h2>
      <p>
        <span class="badge badge-secondary">
          <%= current_user.elo %>
        </span>
      </p>
      <% if current_user.image.url %>
        <%= image_tag(current_user.image.url, class: 'w-50 rounded-circle') %>
      <% else %>
        <%= image_tag 'anonymous.png', class: 'border border-secondary rounded-circle w-50' %>
      <% end %>
    <% end %>
  </div>

  <div class="col-sm-8">

    <div id="toggle-post" class="text-center">
      <%= image_tag 'arrow.png', width: '15' %>
    </div>

    <%= form_with scope: :post, id: 'post-form' do |f| %>
      <div class="form-group text-center">
        <%= f.text_area :content, class: 'form-control', autocomplete: 'off' %>
        <%= f.submit 'Postar', id: 'post-button',class: 'btn btn-sm btn-block btn-primary' %>
      </div>
    <% end %>

    <script>
        var pusher = new Pusher("55d77172c59cfedfe8f9", {
          cluster: 'us2',
          encrypted: true
        });
    </script>

    <div id="new-post-alert">
    </div>
    <div id="posts">
      <%= render @posts %>
    </div>

    <script>
        var channel = pusher.subscribe('posts-channel');
        channel.bind('new-post', function(data) {
            let post_user = data.user;

            if ("<%= current_user.name %>" != post_user) {
              let div = document.getElementById('new-post-alert');
              let new_content = document.createElement("div");
              new_content.innerHTML = `
              <div class="alert alert-primary" role="alert">
                <a href="#" class="alert-link">${post_user} acabou de postar algo</a>
              </div>`;
              $(div).html(new_content);
              $(document).attr("title", "Solokill(New post)");
            }

        });
    </script>

    <div id="carregar-mais" class="my-4 text-center">
      <%= link_to_next_page @posts, 'Carregar mais posts', :remote => true, :id=>"load_more_link" %>
    </div>

  </div>

</div>
